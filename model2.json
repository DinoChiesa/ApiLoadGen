{
  "name": "job7",
  "description": "Exercises APIs exposed by iControl",
  "defaultProperties": {
    "scheme": "http",
    "host": "demo18-test.apigee.net",
    "headers" : {
      "Accept" : "application/json"
    }
  },

  "loadprofiles" : [{ 
    "name" : "loadprofile3", 
    "perHourCounts" : [
      44, 35, 40, 36, 27, 40, 40, 54, 
      57, 62, 54, 61, 73, 70, 53, 50, 
      47, 62, 74, 88, 83, 77, 70, 51
    ] 
  }], 

  "sequences" : [
    {
      "description" : "login",
      "name" : "seqLogin",
      "iterations" : 1,
      "requests" : [ {
        "name": "login",
        "pathSuffix" : "/v1/ictrl/login",
        "method" : "post",
        "headers" : {
          "content-type" : "application/json"
        },
        "payload" : {
          "username":"test",
          "password":"display"
        }, 
        "delayBefore" : 0,
        "extracts" : [
          {
            "description" : "extract the login token",
            "fn" : "function(obj) {return obj.login.token;}",
            "valueRef" : "oauth_bearer_token"
          }, 
          {
            "description" : "extract the user and site hrefs",
            "fn" : "function(obj) {return {user:obj.login.user.href,site:obj.login.site.href};}",
            "valueRef" : "hrefs"
          }
        ]
      }]
    },
    {
      "name" : "seqQuery",
      "description" : "query the user and site items",
      "iterations" : "1",
      "requests" : [ 
        {
          "name" : "retrieveUser",
          "description" : "query the user item",
          "pathSuffix" : "{hrefs.user}",
          "method" : "get",
          "headers" : {
            "authorization" : "Bearer {oauth_bearer_token}"
          }, 
          "delayBefore" : 10
        },
        {
          "name" : "retrieveSite",
          "description" : "retrieve the site",
          "pathSuffix" : "{hrefs.site}",
          "method" : "get",
          "headers" : {
            "authorization" : "Bearer {oauth_bearer_token}"
          }, 
          "delayBefore" : 10, 
          "extracts" : [ {
            "description" : "extract the site-specific hrefs",
            "fn" : "function(obj) { return {provider:obj.provider.href,cmsInfo:obj.cmsInfo.href,network:obj.network.href, users:obj.siteUsers.href,address:obj.address.href} ;}",
            "valueRef" : "siteHrefs"
          }]

        }, 
        {
          "name" : "queryAlarms",
          "description" : "query alarms",
          "pathSuffix" : "{hrefs.site}/alarmSessions?maxResults=100",
          "method" : "get",
          "headers" : {
            "authorization" : "Bearer {oauth_bearer_token}"
          }, 
          "delayBefore" : 10
        }, 
        {
          "name" : "queryImages",
          "description" : "query camera images",
          "pathSuffix" : "{hrefs.site}/cameraImagesAndVideos?start=0&maxResults=10",
          "method" : "get",
          "headers" : {
            "authorization" : "Bearer {oauth_bearer_token}"
          }, 
          "delayBefore" : 10
        }, 
        {
          "name" : "querySecurityEvents",
          "description" : "query security events",
          "pathSuffix" : "{hrefs.site}/securityEvents?maxResults=25",
          "method" : "get",
          "headers" : {
            "authorization" : "Bearer {oauth_bearer_token}"
          }, 
          "delayBefore" : 10
        }, 
        {
          "name" : "querySiteUsers",
          "description" : "query site users",
          "pathSuffix" : "{siteHrefs.users}",
          "method" : "get",
          "headers" : {
            "authorization" : "Bearer {oauth_bearer_token}"
          }, 
          "delayBefore" : 10
        }, 
        {
          "name" : "querySiteAddress",
          "description" : "query site address",
          "pathSuffix" : "{siteHrefs.address}",
          "method" : "get",
          "headers" : {
            "authorization" : "Bearer {oauth_bearer_token}"
          }, 
          "delayBefore" : 10
        }
      ]
    }, 
    {
      "description" : "logout",
      "name" : "seqLogout",
      "iterations" : 1,
      "requests" : [ {
        "name": "logout",
        "pathSuffix" : "/v1/ictrl/logout",
        "method" : "post",
        "headers" : {
          "content-type" : "application/json", 
          "authorization" : "Bearer {oauth_bearer_token}"
        },
        "delayBefore" : 0
      }]
    }
  ]
}
